<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Teste nave - Canvas HTML5</title>
        <script src="js/animacao.js"></script>
        <script src="js/teclado.js"></script>
        <script src="js/nave.js"></script>
        <script src="js/tiro.js"></script>
        <script src="js/colisor.js"></script>
        <script src="js/ovni.js"></script>
        <script src="js/fundo.js"></script>
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <canvas id="palco" width="500" height="500">
            Ops! O seu navegador parece não ter suporte para este recurso.. :(
        </canvas>
        <script>
            // Encontra o canvas e o contexo 2D
            var canvas = document.getElementById('palco');
            var context = canvas.getContext('2d');
            
            // Teclado, animação, colisor (nosso game engine)
            var teclado = new Teclado(document);
            var animacao = new Animacao(context);
            var colisor = new Colisor();
            
            // Registramos o colisor como um processamento
            // da classe animação
            animacao.novoProcessamento(colisor);
            
            // Carrega a imagem do espaço
            var imgEspaco = new Image();
            imgEspaco.src = 'assets/images/fundo-espaco.png';
            imgEspaco.onload = carregando;
            
            // Carega a imagem das estrelas
            var imgEstrelas = new Image();
            imgEstrelas.src = 'assets/images/fundo-estrelas.png';
            imgEstrelas.onload = carregando;
            
            // Carrega a imagem das nuvens
            var imgNuvens = new Image();
            imgNuvens.src = 'assets/images/fundo-nuvens.png';
            imgNuvens.onload = carregando;
            
            // Imagem da nave
            var imgNave = new Image();
            imgNave.src = 'assets/images/nave.png';
            imgNave.onload = carregando;
            
            // Imagem do ovni
            var imgOvni = new Image();
            imgOvni.src = 'assets/images/ovni.png';
            imgOvni.onload = carregando;
            
            
            // Criamos, configuramos e registramos os fundos na classe animacao
            var fundo1 = new Fundo(context, imgEspaco);
            fundo1.velocidade = 3;
            animacao.novoSprite(fundo1);
            
            var fundo2 = new Fundo(context, imgEstrelas);
            fundo2.velocidade = 7;
            animacao.novoSprite(fundo2);
            
            var fundo3 = new Fundo(context, imgNuvens);
            fundo3.velocidade = 10;
            animacao.novoSprite(fundo3);
            
            
            // Criamos a nave
            var nave = new Nave(context, teclado, imgNave);
            
            // Registramos a nave na classe de animacao
            animacao.novoSprite(nave);
            
            // Registramos a nave como um colisor
            colisor.novoSprite(nave);
            
            // Definimos a tecla de ataque da nave
            teclado.disparou(ESPACO, function() {
                nave.atirar();                
            });
            
            
            // Função para criar novos inimigos
            function novoOvni() {
                // Criamos um novo ovni passando o contexto e a imagem
                var ovni = new Ovni(context, imgOvni);
                
                // Setamos uma velocidade randomica entre 5 e 15
                ovni.velocidade = Math.floor(Math.random() * (15 - 5 + 1));
                
                // Setamos a posicao X do ovni (de 0 até canvas.width - imgOvni.width)
                ovni.x = Math.floor(Math.random() * (canvas.width - imgOvni.width + 1));
                
                // Desconta a altura do ovni, para nascer escondido
                ovni.y -= imgOvni.height;
                
                // Registramos na animação e no colisor
                animacao.novoSprite(ovni);
                colisor.novoSprite(ovni);
            }
            
            // Carregamento e inicializacao
            var carregadas = 0;
            var total = 5;
            
            function carregando() {
                carregadas++;
                if (carregadas == total) iniciar();
            }
            
            function iniciar() {
                // Posicionamos a nave e setamos a velocidade
                nave.x = (canvas.width + imgNave.width) / 2;
                nave.y = canvas.height - imgNave.height - 10;
                nave.velocidade = 5;
                
                // Iniciamos a animação
                animacao.ligar();
                
                // Definimos um intervalo para criar novos inimigos
                setInterval(novoOvni, 1000);
            }
        </script>
    </body>
</html>